---
title: "GenerateSubwayPassengerData"
author: "Zheyan"
date: "11/12/2021"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(data.table)
library(rvest)
library(httr)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "95%"
)

theme_set(theme_minimal() + theme(legend.position = 'bottom'))

options(
  ggplot2.continuous.colour = 'viridis',
  ggplot2.continuous.fill = 'viridis'
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Read data from online txt

Generate date series in format like '211106'

```{r}
beginDate = as.Date('2019-01-05')
endDate = as.Date('2021-11-06')

DateSeries = seq(beginDate,endDate,by = 7)

DateSeries = map(DateSeries, ~substr(str_replace_all(.x, "-", ""), 3, 99))

DateSeries[[1]]
```


```{r}
# first try
read_onlinedf = function(date){
  url = paste0("http://web.mta.info/developers/data/nyct/turnstile/turnstile_", date, '.txt')
  df = read_delim(url, delim = ',')
  df
}


df_all = map_df(DateSeries, read_onlinedf)
# df = read_delim("http://web.mta.info/developers/data/nyct/turnstile/turnstile_211106.txt", delim = ',')


fwrite(df_all, 'passenger.csv')
```
```{r}
df %>% 
  group_by(LINENAME) %>% 
  summarise(n = n())
```


